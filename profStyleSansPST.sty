\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{profStyleSansPST}[2019/09/16]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                 style lycée 2019                           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% personnalisation du module fancyhdr
\pagestyle{fancy}
\addtolength{\footskip}{-\baselineskip}
\renewcommand{\footrulewidth}{1mm}
\renewcommand{\footrule}{{%%
    %%\color{gray}%%
    %% \color{\maPScouleur}%%
    \pybleu%
\vskip\footruleskip\vskip-\footrulewidth
\hrule width\headwidth height\footrulewidth\vskip\footruleskip}}
\renewcommand{\headrulewidth}{0mm}
% 
\newcommand{\rheadTexte}{\large\sffamily\slshape%%
  \white%%
  \lamatiere}
\newcommand{\lfootTexte}{%%
  \pybleu%%
  \tiny\sffamily\bfseries% 
  Composé avec Lua\LaTeX{} sous linux à~%
  \directlua{tex.print(os.time())}%
}
\newcommand{\cfootTexte}{\pybleu\thepage/\pageref{LastPage}}
\newcommand{\rfootTexte}{%%
  \begin{tikzpicture}
    \draw (0,0) node {\pybleu\large\sffamily\slshape\RRoman{\number\year}~---~%
    \textsc{Cobac}};
  \end{tikzpicture}
}
% 
  % \begin{tikzpicture}
  %   \begin{scope}
  %     \clip (0,\profCitation) rectangle (\longCitation,\hautCitation+\profCitation);
  %     \node[inner sep=0pt,anchor=south west,red] at (0,0) {\citationformatee};
  %   \end{scope}
  %   \clip (0,0) rectangle (\longCitation,\profCitation);
  %   \node[inner sep=0pt,anchor=south west,blue] at (0,0) {\citationformatee};
  % \end{tikzpicture}
%%
\newcommand{\rheadCitation}{\usebox{\textecitation}}
%
\newlength{\longauteur}
\settowidth{\longauteur}{\rfootTexte}
\newlength{\hautmatiere}
\settoheight{\hautmatiere}{\rheadTexte}
\newlength{\longmatiere}
\settowidth{\longmatiere}{\rheadTexte}
%
\newlength{\rfootYOff}
\setlength{\rfootYOff}{6ex}
\newlength{\rheadXOff}
\setlength{\rheadXOff}{3.7ex - \hautmatiere + 4ex} %% 3.7 correspond au bandeau sans matiere
\newlength{\epaisTrait}
\setlength{\epaisTrait}{1.7mm}
\newlength{\citationXOff}
\setlength{\citationXOff}{\longmatiere + 6pt + 1ex} % 3pt est la distance framesep d'une framebox
\newlength{\citationYOff}
\setlength{\citationYOff}{\epaisTrait-\profCitation}
\newlength{\hautcitation}
\setlength{\hautcitation}{1.5mm + 1ex}
%
%% lalatex, fancyhdr et pstricks ne sont pas les meilleures amies
%% du monde -> hack demandé sur fr.comp.text.tex
\newlength{\etirement}
\setlength{\etirement}{\textheight - \longauteur + \rfootYOff}
% \newsavebox\PSTBoxDroite
% \savebox\PSTBoxDroite{% 
%   \begin{postscript}
%     \psset{unit=1cm}
%     \setlength{\etirement}{\textheight - \longauteur + \rfootYOff}
% %
%     \rput[bl](0,0){\psframe[linewidth=0pt,linestyle=none,fillstyle=solid,fillcolor=\maPScouleur](0,0)(\etirement,\epaisTrait)}%
%     \rput[bl](0,0){\psframebox[linewidth=0pt,linestyle=none,fillstyle=solid,fillcolor=\maPScouleur]{\rheadTexte}}%
%     \if@algo 
%     \else
%     \rput[bl](\citationXOff,\citationYOff){\rheadCitation}%%
%     \fi
%   \end{postscript}% 
% } mai
%
\rfoot{\hbox to0pt{\hspace*{\rfootYOff}\vbox to0pt{\vspace*{-\longauteur}%
      \rotatebox{90}{\rfootTexte}
    }}}
\lfoot{\vspace*{-5mm}\scalebox{-1}[1]{\lfootTexte}}
\cfoot{\vspace*{-3mm}\cfootTexte}
\lhead{}
\chead{}
\rhead{%%
  \hbox to0pt{\hspace*{\rheadXOff}\vbox to0pt{\vspace*{3mm}%%
      \rotatebox{-90}{\colorbox{\pythonBleu}{%%
          \color{white}\large\sffamily\bfseries\lamatiere%%
        }}\vss}\hss}}
%% 
%
%% environnements exo et pb
%% encadrements en pointillés
%
\newcommand{\encadrepointilles}[1]{%
  \expandafter\begin{postscript}%
    \psframebox[linestyle=none,fillcolor=\maPScouleur,fillstyle=solid]{#1}%
  \end{postscript}%
}
%
\newcounter{numeroexo}
\newlength{\htex}
\newlength{\lgex}
\settowidth{\htex}{\encadrepointilles{%
    \scalebox{1.5}[1]{\sffamily Exercice \arabic{numeroexo}}%%
  }}
\addtolength{\htex}{-\baselineskip}
\settoheight{\lgex}{\encadrepointilles{%%
    \scalebox{1.5}[1]{\sffamily Exercice \arabic{numeroexo}}%%
  }}
\addtolength{\lgex}{10pt}
\newenvironment{exercice}{
  \par\noindent\stepcounter{numeroexo}%%\linebreak\hspace*{-\lgex}%
  \begin{mdframed}[linecolor=blue!10,
    roundcorner=3pt,
    innerleftmargin=0pt,
    innerrightmargin=0pt,
    innertopmargin=0pt,
    innerbottommargin=0pt,
    linewidth=2bp,
    backgroundcolor=blue!5
    ]%%
    {\large \bfseries \sffamily Exercice \arabic{numeroexo}}%
  \end{mdframed}
}{%
  %%\vspace{.5\baselineskip}\par%
}
 
\newenvironment{exerciceh}{%%
  \ifthenelse{\equal{\value{numeroexo}}{0}}{}{%%
    %% la séparation des exercices
    \par\noindent{\macouleur\hrule}%%
  }%%
  \par\noindent\stepcounter{numeroexo}\linebreak\hspace*{-\lgex}%
   \smash{%\raisebox{-\htex}{%
       %%\rotatebox{90}{%
       \encadrepointilles{%
         \scalebox{.7}[1]{\white \bfseries \sffamily Exercice \arabic{numeroexo}}%%
       }%
       % }%
       % }%
   }%
   %%\hspace*{\lgex}\hspace*{3pt}%%
 }{%
   \vspace{.5\baselineskip}\par
 }
\newenvironment{nival}{%%
  \ifthenelse{\equal{\value{numeroexo}}{0}}{}{%%
    %% la séparation des exercices
    \par\noindent\hrule%%
  }%%
  \par\noindent\stepcounter{numeroexo}\linebreak\hspace*{-\lgex}%
   \smash{\raisebox{-\htex}{%
       \rotatebox{90}{\encadrepointilles{%
             \scalebox{1.5}[1]{\sffamily Niveau \arabic{numeroexo}}%%
           }}}}%
     \hspace*{\lgex}\hspace*{3pt}%%
 }{%
   \vspace{.5\baselineskip}

 }
%
%% titres de polys
\newlength{\@largeurtitre}
\newlength{\@profondtitre}
\newlength{\@restanttitre}
\newlength{\@hauteurtitre}

\newcommand{\@titre}[1]{%%
  \huge\sffamily\bfseries%%
  \macouleur
  \textpdfrender{
    TextRenderingMode=FillStrokeClip,
    LineWidth=.5pt,
    FillColor=blue!90,
    StrokeColor=white,
    MiterLimit=1
  }{#1}%%
}

\newsavebox{\@titrecomplet}%%
\newlength{\@epaisseurtraittitre}
\setlength{\@epaisseurtraittitre}{2bp}
\newlength{\@coinsarrondis}
\setlength{\@coinsarrondis}{10pt}
\newlength{\@largeursoustitre}
\newlength{\@restantlargeursoustitre}
%%
\newcommand{\titrepoly}[2]{%%
  \settowidth{\@largeurtitre}{\@titre #1}%%
  \settowidth{\@largeursoustitre}{\small #2}
  \setlength{\@restantlargeursoustitre}{\@largeurtitre - \@largeursoustitre}
  %%
  \savebox{\@titrecomplet}{%%
    \begin{minipage}{\@largeurtitre}
      \huge\sffamily\bfseries%%
      \macouleur
      \textpdfrender{
        TextRenderingMode=FillStrokeClip,
        LineWidth=.5pt,
        FillColor=blue!70,
        StrokeColor=yellow!5,
        MiterLimit=1
      }{#1}\\[-4.2mm]
      {\makebox[.67\@restantlargeursoustitre]{\small\color{blue!80}\rightarrowfill}%%
        {\small\color{blue!80} #2}%%
        \makebox[.33\@restantlargeursoustitre]{\small\color{blue!80}\leftarrowfill}%%
      }%%
    \end{minipage}%%
  }%%
  \settodepth{\@profondtitre}{\usebox\@titrecomplet}%%
  \settoheight{\@hauteurtitre}{\usebox\@titrecomplet}%
  \setlength{\@restanttitre}{(\linewidth - \@largeurtitre)/2 }%%
  %%
  \noindent%
  %%\mbox{}\par\bigskip%%
  {
    \begin{tikzpicture}[decoration=Koch snowflake]
      %% rectangle 1/3 de fond avant la boite
      \shade[%%
            rounded corners=0pt,
            opacity=1,
            left color=white,
            right color=blue!20]
            (0,-\@profondtitre+10pt)
            rectangle
            (\@restanttitre - \@coinsarrondis, \@hauteurtitre + \@profondtitre - 10pt);
      %%
      %% fond jaune/blanc du rectangle de titre
      \fill[white,
            rounded corners=\@coinsarrondis,
            line width=0]
            (\@restanttitre - \@coinsarrondis, -\@profondtitre)
            rectangle
            (\@restanttitre+\@largeurtitre + \@coinsarrondis, \@hauteurtitre+\@profondtitre);%%
      %% 
      %% rectangle 2/3 de fond sur le titre
      \fill[%%
            blue!10,
            rounded corners=0pt, opacity=.95]
            (\@restanttitre - \@coinsarrondis, -\@profondtitre+10pt)
            rectangle
            (\@restanttitre+\@largeurtitre + \@coinsarrondis,
            \@hauteurtitre+\@profondtitre-10pt);
            %% 
            %%
      %% rectangle 3/3 de fond après la boîte
      \shade[%%
      %% rounded corners=0pt,
            line width=0pt,
            opacity=1,
            left color=blue!20,
            right color=white]
            (\@restanttitre + \@largeurtitre + \@coinsarrondis, -\@profondtitre+10pt)
            rectangle
            (\linewidth, \@hauteurtitre + \@profondtitre - 10pt);
      %%
      %%
      %% rectangle de fond du titre
      \draw[blue!30,
            rounded corners=\@coinsarrondis,
            line width=\@epaisseurtraittitre]
            (\@restanttitre - \@coinsarrondis, -\@profondtitre)
            rectangle
            (\@restanttitre+\@largeurtitre + \@coinsarrondis, \@hauteurtitre+\@profondtitre);%%
      %%
      %% fractale de fond
      \begin{scope}
        %% on découpe ce scope au rectangle précédent
        \clip(\@restanttitre, -\@profondtitre)
        rectangle (\@restanttitre + \@largeurtitre,
                   \@hauteurtitre + \@profondtitre - \@epaisseurtraittitre / 2);
        %% la fractale
        \filldraw[%%
              draw=blue!80,
              line width=.5pt,
              fill=blue!12,
              opacity=.8]
              decorate { decorate { decorate { decorate { decorate { %%
                        (\@restanttitre, -\@profondtitre + \@epaisseurtraittitre / 2)
                        -- (\@restanttitre + \@largeurtitre,
                        -\@profondtitre + \@epaisseurtraittitre / 2)%
                      }}}}};
      \end{scope}
      %% titre
      \draw (\@restanttitre,0)
      node[shift={(\@largeurtitre / 2,\@hauteurtitre / 2)}] {\usebox\@titrecomplet};
    \end{tikzpicture}%%
  }
}

%% titres de devoirs
\newcommand{\nom}{{\scshape Nom~:}\makebox[.5\linewidth]{\dotfill}}

\newcommand{\devoir}[4]{%%
  \begin{mdframed}[linewidth=2bp,
    linecolor=blue!10,
    backgroundcolor=blue!5,
    roundcorner=5pt]%
    \titrepoly{Devoir #1 \no#2}{devoirs}
    \noindent{\macouleur\sffamily#3\hfill{\itshape #4\hspace*{0ex}}}
  \end{mdframed}%
}

\newcommand{\ds}[3]{%%
  \begin{mdframed}[linewidth=2bp,
    linecolor=blue!10,
    backgroundcolor=blue!5,
    roundcorner=5pt]%
    \titrepoly{Devoir Surveillé n\no#1}{devoirs}
    \noindent
    \macouleur\sffamily#2\hfill\itshape #3\hspace*{0ex}
  \end{mdframed}%
}

\newcommand{\dm}[3]{%%
  \begin{mdframed}[%
    linewidth=2bp,
    linecolor=blue!10,
    backgroundcolor=blue!5,
    roundcorner=5pt]%
    \titrepoly{Devoir Maison n\no#1}{devoirs}
    \macouleur\sffamily#2\hfill\itshape#3
  \end{mdframed}
}

\newcommand{\ie}[1]{%%
  \begin{mdframed}[%
    linewidth=2bp,
    linecolor=blue!10,
    backgroundcolor=blue!5,
    roundcorner=5pt]%
    \titrepoly{Interrogation Écrite n\no#1}{devoirs}
    \macouleur\Large NOM~:\dotfill
  \end{mdframed}
}

\newcommand{\montest}{Mon test}


%%%%%%%%%%%%%%%
%% Dans les tableaux de signes et de variations
\newlength{\@vardelongueur}
\settowidth{\@vardelongueur}{Var. de}
\newcommand{\varde}[1]{%%
  \TVcenter{%
    \parbox{\@vardelongueur}{\centering%
      Var. de\\$#1$%
    }
  }
}

\newlength{\@signedelongueur}
\settowidth{\@signedelongueur}{Signe de}
\newcommand{\sgnde}[1]{%%
  \TVcenter{%
    \parbox{\@signedelongueur}{\centering%
      Signe de\\$#1$%
    }
  }
}
\newcommand{\sgnduq}{%%
  \TVcenter{%
    \parbox{\@signedelongueur}{\centering%
      \scriptsize Signe du\\quotient%
    }
  }
}
\newcommand{\sgndup}{%%
  \TVcenter{%
    \parbox{\@signedelongueur}{\centering%
      \scriptsize Signe du\\produit%
    }
  }
}

\endinput
